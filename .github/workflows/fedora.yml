name: Build on Fedora
on: push

jobs:
  fedora:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        version: [39, 40, 41]
    container:
      image: fedora:${{ matrix.version }}
    steps:
      - uses: actions/checkout@v4
        with:
          repository: 'Macaulay2/M2'
          ref: 'development'
      - name: Install dependencies
        run: |
          sudo dnf install 4ti2 TOPCOM autoconf automake bison boost-devel cddlib-devel cohomCalg csdp-tools diffutils eigen3-devel factory-devel fflas-ffpack-devel flex flint-devel g++ gc-devel gcc-gfortran gdbm-devel gfan git glpk-devel gmp-devel lapack-devel libffi-devel libfrobby-devel libnauty-devel libnormaliz-devel libtool libxml2-devel lrslib-utils make mathic-devel mathicgb-devel memtailor-devel mpfi-devel mpfr-devel mpsolve-devel nauty ncurses-devel normaliz ntl-devel patch python3-devel readline-devel tbb-devel which xz-devel zlib-devel
      - name: Build Macaulay2
        run: |
          cd M2
          make
          cd BUILD
          ../configure --with-system-gc --with-system-memtailor --with-system-mathic --with-system-mathicgb -with-python --enable-download CPPFLAGS=-I/usr/include/frobby
          make
      - name: Test Macaulay2
        run: make test
